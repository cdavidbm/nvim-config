# Navegación vim-tmux
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind-key -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

# ─────────────────────────────────────────────────────────────────────────────────
# Popups
# ─────────────────────────────────────────────────────────────────────────────────
bind C-y display-popup -E -w 80% -h 80% "yazi"
bind C-p display-popup -w 80% -h 60%

# ─────────────────────────────────────────────────────────────────────────────────
# Nuevos paneles y ventanas en la misma ruta
# ─────────────────────────────────────────────────────────────────────────────────
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# ─────────────────────────────────────────────────────────────────────────────────
# Mouse habilitado pero sin el menú molesto
# ─────────────────────────────────────────────────────────────────────────────────
set -g mouse on
unbind -n MouseDown3Pane

# ─────────────────────────────────────────────────────────────────────────────────
# Historial amplio
# ─────────────────────────────────────────────────────────────────────────────────
set -g history-limit 50000

# ─────────────────────────────────────────────────────────────────────────────────
# Copiar al portapapeles del sistema (necesita xclip)
# ─────────────────────────────────────────────────────────────────────────────────
set -g copy-command "xclip -selection clipboard"
bind -T copy-mode MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -selection clipboard"

# ─────────────────────────────────────────────────────────────────────────────────
# Click derecho pega desde el portapapeles
# ─────────────────────────────────────────────────────────────────────────────────
bind -n MouseDown3Pane run "xclip -selection clipboard -o | tmux load-buffer - && tmux paste-buffer"

# ╔══════════════════════════════════════════════════════════════════════════════╗
# ║                           MOONLIGHT THEME                                    ║
# ╚══════════════════════════════════════════════════════════════════════════════╝

# Terminal
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Fondo transparente en los paneles
set -g window-style "bg=default"
set -g window-active-style "bg=default"

# Barra superior con fondo transparente
set -g status-position top
set -g status-style "bg=default"
set -g status-justify centre
set -g status-left-length 100
set -g status-right-length 100
set -g status-interval 1

# ─────────────────────────────────────────────────────────────────────────────────
# Izquierda: sesión, ventana:panel, comando
# ─────────────────────────────────────────────────────────────────────────────────
set -g status-left "\
#[fg=#04d1f9,bold]  #S #[fg=default,nobold] \
#[fg=#b4a4f4,bold]  #I:#P #[fg=default,nobold] \
#[fg=#4bcc00,bold]  #{pane_current_command} #[fg=default,nobold]"

# ─────────────────────────────────────────────────────────────────────────────────
# Derecha: ruta, hora, fecha
# ─────────────────────────────────────────────────────────────────────────────────
set -g status-right "\
#[fg=#ecb2f0,bold]  #{b:pane_current_path} #[fg=default,nobold] \
#[fg=#ffc777,bold]  %H:%M #[fg=default,nobold] \
#[fg=#b994f1,bold]  %d/%m #[fg=default,nobold]"

# ─────────────────────────────────────────────────────────────────────────────────
# Ventanas (centro)
# ─────────────────────────────────────────────────────────────────────────────────
set -g window-status-format "\
#[fg=#757dac] #I #W "

set -g window-status-current-format "\
#[fg=#04d1f9,bold]  #I #W #[fg=default,nobold]"

set -g window-status-separator "  "

# ─────────────────────────────────────────────────────────────────────────────────
# Paneles
# ─────────────────────────────────────────────────────────────────────────────────
set -g pane-border-style "fg=#414863"
set -g pane-active-border-style "fg=#04d1f9"

# Estilo de línea más visible (opciones: single, double, heavy, simple, number)
set -g pane-border-lines double

# Colores con más contraste
set -g pane-border-style "fg=#596399"
set -g pane-active-border-style "fg=#04d1f9,bold"

# ─────────────────────────────────────────────────────────────────────────────────
# Mensajes y modos
# ─────────────────────────────────────────────────────────────────────────────────
set -g message-style "fg=#e4f3fa,bg=default,bold"
set -g message-command-style "fg=#ffc777,bg=default"
set -g mode-style "fg=#e4f3fa,bg=default,reverse"

# ─────────────────────────────────────────────────────────────────────────────────
# Reloj y actividad
# ─────────────────────────────────────────────────────────────────────────────────
set -g clock-mode-colour "#04d1f9"
set -g clock-mode-style 24
set -g monitor-activity on
set -g visual-activity off
set -g window-status-activity-style "fg=#ff757f"

# ─────────────────────────────────────────────────────────────────────────────────
# Display panes
# ─────────────────────────────────────────────────────────────────────────────────
set -g display-panes-active-colour "#04d1f9"
set -g display-panes-colour "#414863"

# ─────────────────────────────────────────────────────────────────────────────────
# Margen superior
# ─────────────────────────────────────────────────────────────────────────────────

set -g pane-border-status top
set -g pane-border-format ""

# ---------------------------------------------------------------------------------
# tmux focus-events
# ---------------------------------------------------------------------------------
set -g focus-events on
